<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>BTree</title>
    <style type="text/css">
        html, body {
            height: 100%;
        }
    </style>
</head>
<body>
<canvas id="canvas" width="100%" height="100%"></canvas>

<input type="text" id="orderValue" style="position: fixed; top: 10px; right: 120px;" value="4"/>
<button onclick="changeOrder()" style="position: fixed;right: 10px;top: 10px;">确定修改阶数</button>

<input type="text" id="addValue" style="position: fixed; top: 40px; right: 60px;" />
<button onclick="addV()" style="position: fixed;right: 10px;top: 40px;">添加</button>

<input type="text" id="deleteValue" style="position: fixed; top: 70px; right: 60px;" />
<button onclick="deleteV()" style="position: fixed;right: 10px;top: 70px;">删除</button>
<script type="text/javascript" src="Node.js"></script>
<script type="text/javascript" src="BTree.js"></script>
<script type="text/javascript">
    let order = 4;
    let bsTree = null;
    let canvasEle = document.getElementById("canvas");
    canvasEle.width = window.innerWidth * order / 2;
    canvasEle.height = window.innerHeight * order;
    let ctx = canvasEle.getContext("2d");
    let startX = window.innerWidth / 2;
    let startY = 30;
    let startSplitY = 60;

    function changeOrder(){
        try {
            let orderValue = parseInt(document.getElementById("orderValue").value);
            if(orderValue < 3){
                alert("阶数不小于3");
                return;
            }
            order = orderValue;
            alert("阶数设置成功！");
        }catch (e){
            alert("阶数必须是正整数！");
        }
        reset();
    }

    function reset(){
        bsTree = new BTree(order);
        bsTree.drawTree(ctx);
    }

    function addV() {
        if(!bsTree){
            bsTree = new BTree(order);
        }
        let addValue = document.getElementById("addValue").value;
        addValue = parseFloat(addValue);

        if(bsTree.search(addValue)!=null){
            alert("节点已经存在！");
            return;
        }

        bsTree.add(addValue);
        let startSplitX = bsTree.getHeight() * startSplitY * order;
        bsTree.drawTree(ctx, startX, startY, startSplitX,startSplitY);
    }

    function deleteV(){
        if(!bsTree){
            bsTree = new BTree(order);
        }
        let deleteValue = document.getElementById("deleteValue").value;
        deleteValue = parseFloat(deleteValue);
        if(bsTree.search(deleteValue)==null){
            alert("节点不存在！");
            return;
        }
        bsTree.delete(deleteValue);
        let startSplitX = bsTree.getHeight() * startSplitY * order;
        bsTree.drawTree(ctx, startX, startY, startSplitX,startSplitY);
    }
</script>
</body>
</html>