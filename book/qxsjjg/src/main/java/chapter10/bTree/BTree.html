<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>BTree</title>
    <style type="text/css">
        html, body {
            height: 100%;
        }
    </style>
</head>
<body>
<canvas id="canvas" width="100%" height="100%"></canvas>

<input type="text" id="orderValue" style="position: fixed; top: 10px; right: 120px;" value="4"/>
<button onclick="changeOrder()" style="position: fixed;right: 10px;top: 10px;">确定修改阶数</button>

<input type="text" id="addValue" style="position: fixed; top: 40px; right: 60px;"/>
<button onclick="addV()" style="position: fixed;right: 10px;top: 40px;">添加</button>

<input type="text" id="deleteValue" style="position: fixed; top: 70px; right: 60px;"/>
<button onclick="deleteV()" style="position: fixed;right: 10px;top: 70px;">删除</button>
<script type="text/javascript" src="Node.js"></script>
<script type="text/javascript" src="BTree.js"></script>
<script type="text/javascript">
    let order = 4;
    let bsTree = null;
    let canvasEle = document.getElementById("canvas");
    let ctx = canvasEle.getContext("2d");
    let orderValueEle = document.getElementById("orderValue");
    let addValueEle = document.getElementById("addValue");
    let deleteValueEle = document.getElementById("deleteValue");
    let splitY = 60;
    canvasEle.width = 10000;

    window.onload = function () {
        setTimeout(function () {
            window.scrollTo({"top": 0, "left": 0, "behavior": 'smooth'});
        }, 1000);
    }

    function isNumber(n) {
        return /^\d+\.?\d*$/.test(n);
    }

    function isInt(n) {
        return /^\d+?\d*$/.test(n);
    }

    function validate() {
        let orderValue = orderValueEle.value;
        if (!isInt(orderValue) || parseInt(orderValue) < 3) {
            alert("阶数设置不正确!");
            return false;
        }
        return true;
    }

    function changeOrder() {
        let orderValue = orderValueEle.value;
        if (!validate()) {
            return;
        }
        orderValue = parseInt(orderValue);
        orderValueEle.value = orderValue;
        order = orderValue;
        alert("阶数设置成功！");
        reset();
    }

    function reset() {
        bsTree = new BTree(order);
        bsTree.drawTreeOptimize(ctx);
    }

    function addV() {
        if (!bsTree) {
            bsTree = new BTree(order);
        }
        if (!validate()) {
            return;
        }
        let addValue = addValueEle.value;
        if (!isNumber(addValue)) {
            alert("请输入数字!");
            return;
        }
        addValue = parseFloat(addValue);
        if (bsTree.search(addValue) != null) {
            alert("节点已经存在！");
            return;
        }
        bsTree.add(addValue);
        let treeHeight = bsTree.getHeight();
        canvasEle.height = treeHeight * splitY + window.innerHeight;
        bsTree.drawTreeOptimize(ctx, 50, 50, splitY);
        addValueEle.value = "";
    }

    function deleteV() {
        if (!bsTree) {
            bsTree = new BTree(order);
        }
        if (!validate()) {
            return;
        }
        let deleteValue = deleteValueEle.value;
        if (!isNumber(deleteValue)) {
            alert("请输入数字!");
            return;
        }
        deleteValue = parseFloat(deleteValue);
        if (bsTree.search(deleteValue) == null) {
            alert("节点不存在！");
            return;
        }
        bsTree.delete(deleteValue);
        let treeHeight = bsTree.getHeight();
        canvasEle.height = treeHeight * splitY + window.innerHeight;
        bsTree.drawTreeOptimize(ctx, 50, 50, splitY);
        deleteValueEle.value = "";
    }
</script>
</body>
</html>